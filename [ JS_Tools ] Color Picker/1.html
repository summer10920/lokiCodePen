<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="1.css">
</head>

<body>
  <input type="color" id="inputColor">
  <label id="hexText"></label>
  <div>
    <input type="number" id="numberR" min="0" max="255">
    <input type="range" min="0" max="255" id="inputRangeR">
    <br>
    <input type="number" id="numberG" min="0" max="255">
    <input type="range" min="0" max="255" id="inputRangeG">
    <br>
    <input type="number" id="numberB" min="0" max="255">
    <input type="range" min="0" max="255" id="inputRangeB">
    <br><br>
    <input type="button" value="+">
    <input type="button" value="-"  >
    <input type="button" value="?" id="buttonRand">
  </div>
  <script>
    const body = document.body;
    const hexText = document.querySelector("#hexText");
    const inputColor = document.querySelector("#inputColor");
    const inputRangeR = document.querySelector("#inputRangeR");
    const inputRangeG = document.querySelector("#inputRangeG");
    const inputRangeB = document.querySelector("#inputRangeB");
    const numberR = document.querySelector("#numberR");
    const numberG = document.querySelector("#numberG");
    const numberB = document.querySelector("#numberB");
    const buttonRand = document.querySelector("#buttonRand");
    let runFlag = null;

    const colorProxy = new Proxy({ hex: null }, {
      set(obj, prop, hex) {
        obj[prop] = hex;
        body.style.backgroundColor = hex;
        hexText.innerText = hex;
        const rgb = colorCalc(hex);
        hexText.style.color = "rgb(" + (255 - rgb.r) + "," + (255 - rgb.g) + "," + (255 - rgb.b) + ")";

        inputRangeR.value = rgb.r;
        inputRangeG.value = rgb.g;
        inputRangeB.value = rgb.b;
        numberR.value = rgb.r;
        numberG.value = rgb.g;
        numberB.value = rgb.b;

        return true;
      }
    });


    body.addEventListener("click", (e) => {
      Object.assign(inputColor.style, {
        left: `${e.clientX}px`, top: `${e.clientY}px`
      });
      requestAnimationFrame(() => inputColor.click());
    })

    inputColor.addEventListener("click", (e) => e.stopImmediatePropagation());
    inputRangeR.addEventListener("click", (e) => e.stopImmediatePropagation());
    inputRangeG.addEventListener("click", (e) => e.stopImmediatePropagation());
    inputRangeB.addEventListener("click", (e) => e.stopImmediatePropagation());
    numberR.addEventListener("click", (e) => e.stopImmediatePropagation());
    numberG.addEventListener("click", (e) => e.stopImmediatePropagation());
    numberB.addEventListener("click", (e) => e.stopImmediatePropagation());
    buttonRand.addEventListener("click", (e) => e.stopImmediatePropagation());


    inputColor.addEventListener("input", (e) => colorProxy.hex = e.target.value);

    inputRangeR.addEventListener('input', (e) => colorProxy.hex = '#' + tenToHex(e.target.value) + colorProxy.hex.slice(3, 7));
    inputRangeG.addEventListener('input', (e) => colorProxy.hex = '#' + colorProxy.hex.slice(1, 3) + tenToHex(e.target.value) + colorProxy.hex.slice(5, 7));
    inputRangeB.addEventListener('input', (e) => colorProxy.hex = '#' + colorProxy.hex.slice(1, 5) + tenToHex(e.target.value));
    numberR.addEventListener('input', (e) => {
      if (e.target.value > 255) e.target.value = 255;
      colorProxy.hex = '#' + tenToHex(e.target.value) + colorProxy.hex.slice(3, 7)
    });
    numberG.addEventListener('input', (e) => {
      if (e.target.value > 255) e.target.value = 255;
      colorProxy.hex = '#' + colorProxy.hex.slice(1, 3) + tenToHex(e.target.value) + colorProxy.hex.slice(5, 7)
    });
    numberB.addEventListener('input', (e) => {
      if (e.target.value > 255) e.target.value = 255;
      colorProxy.hex = '#' + colorProxy.hex.slice(1, 5) + tenToHex(e.target.value)
    });

    buttonRand.addEventListener("mousedown", (e) => runFlag = setInterval(randHex, 100));
    buttonRand.addEventListener("mouseup", (e) => clearInterval(runFlag));



    function colorCalc(color) {
      switch (typeof color) {
        case 'string':
          return {
            r: parseInt(color.slice(1, 3), 16),
            g: parseInt(color.slice(3, 5), 16),
            b: parseInt(color.slice(5, 7), 16)
          };
          break;
        case 'object':
          return `#${tenToHex(rgb.r)}${tenToHex(rgb.g)}${tenToHex(rgb.b)}`;
          break;
      }
    }

    function randHex() {
      colorProxy.hex = `#${tenToHex(Math.floor(Math.random() * 256))}${tenToHex(Math.floor(Math.random() * 256))}${tenToHex(Math.floor(Math.random() * 256))}`
    }

    function tenToHex(num) {
      if (typeof num === 'string') num = Number(num);
      return num.toString(16).padStart(2, '0');
    }

    randHex();



    // function cont(select) {   //連續作業
    //   run = setInterval(function () {
    //     switch (select) {
    //       case 'add':
    //         if (rgb.r < 255) rgb.r++;
    //         if (rgb.g < 255) rgb.g++;
    //         if (rgb.b < 255) rgb.b++;
    //         break;
    //       case 'sub':
    //         if (rgb.r > 0) rgb.r--;
    //         if (rgb.g > 0) rgb.g--;
    //         if (rgb.b > 0) rgb.b--;
    //         break;
    //       case 'rand':
    //         rgb.r = Math.floor((Math.random() * 256));
    //         rgb.g = Math.floor((Math.random() * 256));
    //         rgb.b = Math.floor((Math.random() * 256));
    //         break;
    //     }
    //     print_rgb();
    //   }, 30);
    // }
    // function sbar(clr, obj) {
    //   rgb[clr] = Number(obj.value);
    //   print_rgb();
    // }
  </script>
</body>

</html>